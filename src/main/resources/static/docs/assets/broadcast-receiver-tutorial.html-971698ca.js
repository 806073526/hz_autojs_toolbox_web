import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as e,o as p,c as o,a as c,d as n,e as s,b as i,f as l}from"./app-ff93bfbc.js";const u={},r=n("h3",{id:"简介",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#简介","aria-hidden":"true"},"#"),s(" 简介")],-1),d=n("p",null,"在 Android 平台上，广播接收器是一种组件，用于监听和响应系统或应用程序发出的广播消息。通过注册广播接收器，您可以在特定事件发生时执行相应的操作。",-1),k=n("p",null,"本教程将引导您使用 Auto.js Pro 和 JavaScript 编程语言编写一个简单的 Android 广播接收器，用于监听电话状态和拨打电话事件。",-1),v=n("h3",{id:"前提条件",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#前提条件","aria-hidden":"true"},"#"),s(" 前提条件")],-1),m=n("p",null,"在开始之前，请确保您已满足以下前提条件：",-1),b={href:"https://pro.autojs.org/",target:"_blank",rel:"noopener noreferrer"},h=n("li",null,"具备 JavaScript 基础知识：本教程假设您具备基本的 JavaScript 编程知识。",-1),g=l(`<h3 id="步骤-1-导入必要的类" tabindex="-1"><a class="header-anchor" href="#步骤-1-导入必要的类" aria-hidden="true">#</a> 步骤 1：导入必要的类</h3><p>首先，在代码中导入所需的类。在这个例子中，我们需要使用 <code>TelephonyManager</code>、<code>Intent</code> 和 <code>IntentFilter</code> 类。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">importClass</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>telephony<span class="token punctuation">.</span>TelephonyManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">importClass</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">importClass</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>IntentFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="步骤-2-创建-intentfilter-并添加要监听的动作" tabindex="-1"><a class="header-anchor" href="#步骤-2-创建-intentfilter-并添加要监听的动作" aria-hidden="true">#</a> 步骤 2：创建 IntentFilter 并添加要监听的动作</h3><p>接下来，创建一个 <code>IntentFilter</code> 对象，并添加要监听的动作。在这个例子中，我们将监听电话状态变化的动作 <code>android.intent.action.PHONE_STATE</code>。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
filter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">&quot;android.intent.action.PHONE_STATE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="步骤-3-创建广播接收器" tabindex="-1"><a class="header-anchor" href="#步骤-3-创建广播接收器" aria-hidden="true">#</a> 步骤 3：创建广播接收器</h3><p>然后，我们将创建一个广播接收器。通过继承 <code>android.content.BroadcastReceiver</code> 类，并重写 <code>onReceive</code> 方法来实现广播接收器。</p><p>在 <code>onReceive</code> 方法中，我们可以根据接收到的 <code>Intent</code> 对象进行相应的逻辑处理。在这个例子中，我们打印出广播的动作和电话状态。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> myBroadcastReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaAdapter</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>BroadcastReceiver<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onReceive</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> intent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> action <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#39;android.intent.action.PHONE_STATE&#39;</span> <span class="token operator">==</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> state <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span>TelephonyManager<span class="token punctuation">.</span><span class="token constant">EXTRA_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">&#39;IDLE&#39;</span><span class="token operator">:</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;挂断电话&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&#39;RINGING&#39;</span><span class="token operator">:</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;电话正在响铃&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&#39;OFFHOOK&#39;</span><span class="token operator">:</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;电话处于通话状态&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="步骤-4-注册广播接收器" tabindex="-1"><a class="header-anchor" href="#步骤-4-注册广播接收器" aria-hidden="true">#</a> 步骤 4：注册广播接收器</h3><p>接下来，我们将广播接收器注册到系统中，以便接收相应的广播消息。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>context<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>myBroadcastReceiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册广播接收器</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="步骤-5-执行代码" tabindex="-1"><a class="header-anchor" href="#步骤-5-执行代码" aria-hidden="true">#</a> 步骤 5：执行代码</h3><p>最后，我们可以在一个循环中保持代码的执行，以便持续监听广播消息。在这个例子中，我们使用 <code>setInterval</code> 函数来实现每秒执行一次的功能。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 保持代码执行</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="步骤-6-取消注册广播接收器" tabindex="-1"><a class="header-anchor" href="#步骤-6-取消注册广播接收器" aria-hidden="true">#</a> 步骤 6：取消注册广播接收器</h3><p>在代码执行结束时，我们需要取消注册广播接收器，以释放资源，否则会导致内存泄漏。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>$events<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;exit&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>myBroadcastReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="完整代码" tabindex="-1"><a class="header-anchor" href="#完整代码" aria-hidden="true">#</a> 完整代码</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * 注册电话状态广播接收器
 */</span>
<span class="token keyword">function</span> <span class="token function">registerPhoneStateReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">importClass</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>telephony<span class="token punctuation">.</span>TelephonyManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">importClass</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">importClass</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>IntentFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">&quot;android.intent.action.PHONE_STATE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 监听电话状态变化</span>
    
    <span class="token keyword">let</span> myBroadcastReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaAdapter</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>BroadcastReceiver<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * 接收广播回调函数
         * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context<span class="token punctuation">}</span></span> <span class="token parameter">context</span> 广播上下文对象
         * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span> <span class="token parameter">intent</span> 广播意图对象
         */</span>
        <span class="token function-variable function">onReceive</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> intent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> action <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#39;android.intent.action.PHONE_STATE&#39;</span> <span class="token operator">==</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 监听来电状态</span>
                <span class="token keyword">let</span> state <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span>TelephonyManager<span class="token punctuation">.</span><span class="token constant">EXTRA_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">switch</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token string">&#39;IDLE&#39;</span><span class="token operator">:</span>
                        <span class="token comment">// 挂断电话</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;挂断电话&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">&#39;RINGING&#39;</span><span class="token operator">:</span>
                        <span class="token comment">// 电话正在响铃</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;电话正在响铃&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">&#39;OFFHOOK&#39;</span><span class="token operator">:</span>
                        <span class="token comment">// 电话处于通话状态</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;电话处于通话状态&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">default</span><span class="token operator">:</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>myBroadcastReceiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册广播接收器</span>
    $events<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;exit&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 取消注册广播接收器，否则会导致内存泄露</span>
        context<span class="token punctuation">.</span><span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>myBroadcastReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">registerPhoneStateReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 用于脚本保活，ui界面不需要</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="结论" tabindex="-1"><a class="header-anchor" href="#结论" aria-hidden="true">#</a> 结论</h3><p>通过以上步骤，您已经成功编写了一个简单的 Android 广播接收器，用于监听电话状态。您可以根据实际需求进一步扩展和修改代码功能。</p><p>希望本教程对您有所帮助！如果您有任何问题，请随时提问。</p><p><strong>注意：请确保遵守当地法律法规，并尊重他人的隐私和通信权利。</strong></p>`,25);function f(y,w){const a=e("ExternalLinkIcon");return p(),o("div",null,[c(" more "),r,d,k,v,m,n("ol",null,[n("li",null,[s("安装 Auto.js Pro：您可以从 "),n("a",b,[s("Auto.js Pro 官方网站"),i(a)]),s(" 下载并安装 Auto.js Pro 应用程序。")]),h]),g])}const j=t(u,[["render",f],["__file","broadcast-receiver-tutorial.html.vue"]]);export{j as default};
