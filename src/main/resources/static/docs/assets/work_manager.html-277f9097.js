import{_ as c}from"./plugin-vue_export-helper-c27b6911.js";import{r as l,o as i,c as d,d as n,b as s,w as e,e as a,f as o}from"./app-ff93bfbc.js";const r={},u=o(`<p>该模块用于管理任务，用于在某些时间或某些事件、处理文件时自动运行脚本。正如Auto.js Pro内置的定时任务功能一样，打包的脚本也可以使用这些函数来创建定时任务。</p><p>添加任务时建议加上申请忽略电池优化的代码，防止被Android限制在后台运行。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string">&quot;nodejs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> power_manager <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;power_manager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>power_manager<span class="token punctuation">.</span><span class="token function">isIgnoringBatteryOptimizations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;未开启忽略电池优化&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  power_manager<span class="token punctuation">.</span><span class="token function">requestIgnoreBatteryOptimizations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>由于各系统的限制，定时任务不能一定保证准时运行，请尽量将Auto.js Pro加入各种白名单和允许自启动权限。</p></blockquote><h2 id="目录" tabindex="-1"><a class="header-anchor" href="#目录" aria-hidden="true">#</a> 目录</h2><h3 id="接口" tabindex="-1"><a class="header-anchor" href="#接口" aria-hidden="true">#</a> 接口</h3>`,6),k=n("h3",{id:"类型别名",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#类型别名","aria-hidden":"true"},"#"),a(" 类型别名")],-1),h=n("h3",{id:"函数",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#函数","aria-hidden":"true"},"#"),a(" 函数")],-1),g=o('<h2 id="类型别名-1" tabindex="-1"><a class="header-anchor" href="#类型别名-1" aria-hidden="true">#</a> 类型别名</h2><h3 id="datetime" tabindex="-1"><a class="header-anchor" href="#datetime" aria-hidden="true">#</a> DateTime</h3><p>Ƭ <strong>DateTime</strong>: <code>number</code> | <code>string</code> | <code>Date</code></p><p>日期时间类型，可以是number，表示毫秒时间戳；可以是string，表示标准时间格式；可以是Date对象，表示日期对象。</p><hr><h3 id="daysofweek" tabindex="-1"><a class="header-anchor" href="#daysofweek" aria-hidden="true">#</a> DaysOfWeek</h3><p>Ƭ <strong>DaysOfWeek</strong>: <code>&quot;Sunday&quot;</code> | <code>&quot;Monday&quot;</code> | <code>&quot;Tuesday&quot;</code> | <code>&quot;Wednesday&quot;</code> | <code>&quot;Thursday&quot;</code> | <code>&quot;Friday&quot;</code> | <code>&quot;Saturday&quot;</code> | <code>&quot;一&quot;</code> | <code>&quot;二&quot;</code> | <code>&quot;三&quot;</code> | <code>&quot;四&quot;</code> | <code>&quot;五&quot;</code> | <code>&quot;六&quot;</code> | <code>&quot;日&quot;</code></p><hr><h3 id="tasktype" tabindex="-1"><a class="header-anchor" href="#tasktype" aria-hidden="true">#</a> TaskType</h3><p>Ƭ <strong>TaskType</strong>: <code>&quot;TimedTask&quot;</code> | <code>&quot;IntentTask&quot;</code></p><h2 id="函数-1" tabindex="-1"><a class="header-anchor" href="#函数-1" aria-hidden="true">#</a> 函数</h2><h3 id="addactivityintenttask" tabindex="-1"><a class="header-anchor" href="#addactivityintenttask" aria-hidden="true">#</a> addActivityIntentTask</h3><p>▸ <strong>addActivityIntentTask</strong>(<code>task</code>): <code>Promise</code>&lt;<code>Task</code>&gt;</p><p>添加在外部应用处理文件时运行的任意图务。比如文件管理中请求打开文件、其他应用中分享文件或文本时，若选择由Auto.js处理，则触发相应任务运行。</p><p>首要参数是action，决定了什么动作会触发任务运行。比如：</p>',15),m=n("li",null,[n("code",null,"android.intent.action.VIEW"),a("：外部应用打开文件时触发，比如文件管理器中打开mp3、apk等文件")],-1),v=n("li",null,[n("code",null,"android.intent.action.SEND"),a("：其他应用分享文件时触发")],-1),f={href:"https://developer.android.google.cn/reference/android/content/Intent#constants_1",target:"_blank",rel:"noopener noreferrer"},y=o(`<p>其次是dataType，决定了什么类型的文件会触发任务运行。比如：</p><ul><li><em>/</em>：所有文件</li><li>application/vnd.android.package-archive: apk文件</li><li>text/plain: 文本文件</li><li>video/*: 视频文件</li><li>image/*: 图片文件</li></ul><p>以下代码执行后将添加一个可以在外部应用查看文本文件的任务：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> addActivityIntentTask <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;work_manager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">addActivityIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/handle_text.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&#39;android.intent.action.VIEW&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Task </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>task<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> added</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下代码是handle_text.js的内容，他会执行时读取要处理的文件内容并打印：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// handle_text.js
&quot;nodejs&quot;;
const { myEngine } = require(&#39;engines&#39;);
const { getPathFromUri } = require(&#39;app&#39;);
const { readFileSync } = require(&#39;fs&#39;);
const intent = myEngine().execArgv.intent;
if (!intent) {
    process.exit();
}
const uri = intent.getUri();
const file = getPathFromUri(uri);
console.log(file);
console.log(readFileSync(file, &#39;utf8&#39;));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="参数" tabindex="-1"><a class="header-anchor" href="#参数" aria-hidden="true">#</a> 参数</h4>`,7),_=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"名称"),n("th",{style:{"text-align":"left"}},"类型"),n("th",{style:{"text-align":"left"}},"描述")])],-1),b=n("td",{style:{"text-align":"left"}},[n("code",null,"task")],-1),T={style:{"text-align":"left"}},x=n("code",null,"IntentTaskConfig",-1),q=n("td",{style:{"text-align":"left"}},"意图任务配置",-1),I=o(`<h4 id="返回值" tabindex="-1"><a class="header-anchor" href="#返回值" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code>&gt;</p><p>添加的任务的Promise</p><hr><h3 id="addbroadcastintenttask" tabindex="-1"><a class="header-anchor" href="#addbroadcastintenttask" aria-hidden="true">#</a> addBroadcastIntentTask</h3><p>▸ <strong>addBroadcastIntentTask</strong>(<code>task</code>): <code>Promise</code>&lt;<code>Task</code>&gt;</p><p>新增一个广播任务，会在特定事件(广播)时运行。</p><p>最关键的参数是广播事件的Action。系统在发生特定事件（比如电量变化）时会发出特定Action的广播。</p><p>例如创建一个在电量发生变化时运行脚本的定时任务：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string">&quot;nodejs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> android <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;rhino&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Packages<span class="token punctuation">;</span>
<span class="token keyword">const</span> Intent <span class="token operator">=</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Intent<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> addBroadcastIntentTask <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;work_manager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">addBroadcastIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/path/to/script.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> Intent<span class="token punctuation">.</span><span class="token constant">ACTION_BATTERY_CHANGED</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Task </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>task<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> added</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10),w={href:"https://developer.android.google.cn/reference/android/content/Intent#constants_1",target:"_blank",rel:"noopener noreferrer"},A=n("code",null,"ConnectivityManager.CONNECTIVITY_ACTION",-1),C=o(`<p>以下列出一些常见的广播Action：</p><ul><li>org.autojs.autojs.action.startup : Auto.js启动时，可给Auto.js加上自启动后使任务在开机时运行</li><li>Intent.ACTION_BOOT_COMPLETED : 开机时</li><li>Intent.ACTION_SCREEN_OFF : 熄屏时</li><li>Intent.ACTION_SCREEN_ON : 亮屏时</li><li>Intent.ACTION_USER_PRESENT : 屏幕解锁时</li><li>Intent.ACTION_BATTERY_CHANGED : 电量变化时</li><li>Intent.ACTION_POWER_CONNECTED : 电源连接时</li><li>Intent.ACTION_POWER_DISCONNECTED : 电源断开时</li><li>ConnectivityManager.CONNECTIVITY_ACTION : 网络连接变化时</li><li>Intent.ACTION_PACKAGE_ADDED : 新应用安装时</li><li>Intent.ACTION_PACKAGE_REMOVED : 应用卸载时</li><li>Intent.ACTION_PACKAGE_REPLACED : 应用更新时</li><li>Intent.ACTION_HEADSET_PLUG : 耳机拔插时</li><li>Intent.ACTION_CONFIGURATION_CHANGED : 某些设置（屏幕方向、地区等）更改时</li><li>Intent.ACTION_TIME_TICK : 每分钟一次</li></ul><p>在广播任务运行时，通过<code>require(&#39;engines&#39;).myEngine().execArgv.intent</code>获取广播的Intent对象，通过Intent对象获取对应的参数。</p><p>以下是电量变化时触发的任务脚本，获取当前电量。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string">&quot;nodejs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> myEngine <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;engines&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> android <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;rhino&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Packages<span class="token punctuation">;</span>

<span class="token keyword">const</span> intent <span class="token operator">=</span> <span class="token function">myEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execArgv<span class="token punctuation">.</span>intent<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> BatteryManager <span class="token operator">=</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>BatteryManager<span class="token punctuation">;</span>
<span class="token keyword">const</span> level <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getIntExtra</span><span class="token punctuation">(</span>BatteryManager<span class="token punctuation">.</span><span class="token constant">EXTRA_LEVEL</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Battery:&quot;</span><span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="参数-1" tabindex="-1"><a class="header-anchor" href="#参数-1" aria-hidden="true">#</a> 参数</h4>`,6),j=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"名称"),n("th",{style:{"text-align":"left"}},"类型"),n("th",{style:{"text-align":"left"}},"描述")])],-1),E=n("td",{style:{"text-align":"left"}},[n("code",null,"task")],-1),P={style:{"text-align":"left"}},O=n("code",null,"IntentTaskConfig",-1),N=n("td",{style:{"text-align":"left"}},"意图任务配置",-1),D=o(`<h4 id="返回值-1" tabindex="-1"><a class="header-anchor" href="#返回值-1" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code>&gt;</p><p>添加的任务的Promise</p><hr><h3 id="adddailytask" tabindex="-1"><a class="header-anchor" href="#adddailytask" aria-hidden="true">#</a> addDailyTask</h3><p>▸ <strong>addDailyTask</strong>(<code>task</code>): <code>Promise</code>&lt;<code>Task</code>&gt;</p><p>新增一个每日运行一次的定时任务。其中时间参数会只保留每天的时间，忽略年月日。 例如创建一个每日下午1点14分运行的定时任务。</p><p><strong><code>示例</code></strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string">&quot;nodejs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> addDailyTask <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;work_manager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">addDailyTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/path/to/script.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="参数-2" tabindex="-1"><a class="header-anchor" href="#参数-2" aria-hidden="true">#</a> 参数</h4>`,10),B=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"名称"),n("th",{style:{"text-align":"left"}},"类型"),n("th",{style:{"text-align":"left"}},"描述")])],-1),W=n("td",{style:{"text-align":"left"}},[n("code",null,"task")],-1),R={style:{"text-align":"left"}},M=n("code",null,"TimedTaskConfig",-1),S=n("td",{style:{"text-align":"left"}},"用于描述此定时任务的配置",-1),G=o('<h4 id="返回值-2" tabindex="-1"><a class="header-anchor" href="#返回值-2" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code>&gt;</p><hr><h3 id="addintenttask" tabindex="-1"><a class="header-anchor" href="#addintenttask" aria-hidden="true">#</a> addIntentTask</h3><p>▸ <strong>addIntentTask</strong>(<code>task</code>): <code>Promise</code>&lt;<code>Task</code>&gt;</p><p>新增一个意图任务，分为两种类型：</p><ul><li>广播意图任务：会在特定事件(广播)时运行。</li><li>活动意图任务：在外部应用处理文件时运行。比如文件管理中请求打开文件、其他应用中分享文件或文本时，若选择由Auto.js处理，则触发相应任务运行。</li></ul>',7),V={href:"/v9/generated/modules/work_manager.html#addbroadcastintenttask",target:"_blank",rel:"noopener noreferrer"},L={href:"https://pro.autojs.org/docs/zh/v9/generated/modules/work_manager.md#addactivityintenttask",target:"_blank",rel:"noopener noreferrer"},Q=n("h4",{id:"参数-3",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#参数-3","aria-hidden":"true"},"#"),a(" 参数")],-1),F=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"名称"),n("th",{style:{"text-align":"left"}},"类型")])],-1),U=n("td",{style:{"text-align":"left"}},[n("code",null,"task")],-1),H={style:{"text-align":"left"}},Y=n("code",null,"IntentTaskConfig",-1),K=o(`<h4 id="返回值-3" tabindex="-1"><a class="header-anchor" href="#返回值-3" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code>&gt;</p><hr><h3 id="addonetimetask" tabindex="-1"><a class="header-anchor" href="#addonetimetask" aria-hidden="true">#</a> addOneTimeTask</h3><p>▸ <strong>addOneTimeTask</strong>(<code>task</code>): <code>Promise</code>&lt;<code>Task</code>&gt;</p><p>此函数会新增一个一次性的定时任务，任务在执行一次后将在定时任务中自动删除。</p><p>例如创建一个2021年5月21日13点14分运行的定时任务。</p><p><strong><code>示例</code></strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string">&quot;nodejs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> addOneTimeTask <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;work_manager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">addOneTimeTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/to/script.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="参数-4" tabindex="-1"><a class="header-anchor" href="#参数-4" aria-hidden="true">#</a> 参数</h4>`,10),z=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"名称"),n("th",{style:{"text-align":"left"}},"类型")])],-1),$=n("td",{style:{"text-align":"left"}},[n("code",null,"task")],-1),J={style:{"text-align":"left"}},X=n("code",null,"TimedTaskConfig",-1),Z=o(`<h4 id="返回值-4" tabindex="-1"><a class="header-anchor" href="#返回值-4" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code>&gt;</p><hr><h3 id="addweeklytask" tabindex="-1"><a class="header-anchor" href="#addweeklytask" aria-hidden="true">#</a> addWeeklyTask</h3><p>▸ <strong>addWeeklyTask</strong>(<code>task</code>): <code>Promise</code>&lt;<code>Task</code>&gt;</p><p>新增一个按星期运行的定时任务。</p><p>例如创建一个每周一周二下午1点14分的定时任务</p><p><strong><code>示例</code></strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string">&quot;nodejs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> addWeeklyTask <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;work_manager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">addWeeklyTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// Mon Jun 21 2021 13:14:00 GMT+0800 </span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">1624252440000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">daysOfWeek</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;Monday&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Tuesday&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="参数-5" tabindex="-1"><a class="header-anchor" href="#参数-5" aria-hidden="true">#</a> 参数</h4><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><code>task</code></td><td style="text-align:left;"><code>WeeklyTaskConfig</code></td><td style="text-align:left;">用于描述此定时任务的配置</td></tr></tbody></table><h4 id="返回值-5" tabindex="-1"><a class="header-anchor" href="#返回值-5" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code>&gt;</p><hr><h3 id="getintenttask" tabindex="-1"><a class="header-anchor" href="#getintenttask" aria-hidden="true">#</a> getIntentTask</h3><p>▸ <strong>getIntentTask</strong>(<code>id</code>): <code>Promise</code>&lt;<code>Task</code> | <code>null</code>&gt;</p><p>根据任务id获取意图任务。</p><p><strong><code>参见</code></strong></p>`,18),nn={href:"http://Task.id",target:"_blank",rel:"noopener noreferrer"},an=o('<h4 id="参数-6" tabindex="-1"><a class="header-anchor" href="#参数-6" aria-hidden="true">#</a> 参数</h4><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code></td><td style="text-align:left;"><code>number</code></td><td style="text-align:left;">任务ID</td></tr></tbody></table><h4 id="返回值-6" tabindex="-1"><a class="header-anchor" href="#返回值-6" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code> | <code>null</code>&gt;</p><p>查询的任务的Promise，如果没有找到则resolve null</p><hr><h3 id="gettimedtask" tabindex="-1"><a class="header-anchor" href="#gettimedtask" aria-hidden="true">#</a> getTimedTask</h3><p>▸ <strong>getTimedTask</strong>(<code>id</code>): <code>Promise</code>&lt;<code>Task</code> | <code>null</code>&gt;</p><p>根据任务id获取定时任务。</p><p><strong><code>参见</code></strong></p>',10),sn={href:"http://Task.id",target:"_blank",rel:"noopener noreferrer"},tn=o(`<h4 id="参数-7" tabindex="-1"><a class="header-anchor" href="#参数-7" aria-hidden="true">#</a> 参数</h4><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code></td><td style="text-align:left;"><code>number</code></td><td style="text-align:left;">任务ID</td></tr></tbody></table><h4 id="返回值-7" tabindex="-1"><a class="header-anchor" href="#返回值-7" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code> | <code>null</code>&gt;</p><p>查询的任务的Promise，如果没有找到则resolve null</p><hr><h3 id="queryintenttasks" tabindex="-1"><a class="header-anchor" href="#queryintenttasks" aria-hidden="true">#</a> queryIntentTasks</h3><p>▸ <strong>queryIntentTasks</strong>(<code>query?</code>): <code>Promise</code>&lt;<code>Task</code>[]&gt;</p><p>通过脚本路径或Intent Action等条件查询意图任务。</p><p><strong><code>示例</code></strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string">&quot;nodejs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> queryIntentTasks<span class="token punctuation">,</span> addBroadcastIntentTask <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;work_manager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">addBroadcastIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/to/script.js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">action</span><span class="token operator">:</span> Intent<span class="token punctuation">.</span><span class="token constant">ACTION_BATTERY_CHANGED</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Query all intent tasks</span>
    <span class="token keyword">const</span> tasks <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">queryIntentTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="参数-8" tabindex="-1"><a class="header-anchor" href="#参数-8" aria-hidden="true">#</a> 参数</h4>`,12),en=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"名称"),n("th",{style:{"text-align":"left"}},"类型"),n("th",{style:{"text-align":"left"}},"描述")])],-1),on=n("td",{style:{"text-align":"left"}},[n("code",null,"query?")],-1),pn={style:{"text-align":"left"}},ln=n("code",null,"IntentTaskQuery",-1),cn=n("td",{style:{"text-align":"left"}},"intent任务查询条件，为空则查询所有任务",-1),dn=o(`<h4 id="返回值-8" tabindex="-1"><a class="header-anchor" href="#返回值-8" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code>[]&gt;</p><hr><h3 id="querytimedtasks" tabindex="-1"><a class="header-anchor" href="#querytimedtasks" aria-hidden="true">#</a> queryTimedTasks</h3><p>▸ <strong>queryTimedTasks</strong>(<code>query?</code>): <code>Promise</code>&lt;<code>Task</code>[]&gt;</p><p>通过脚本路径等条件查询定时任务。</p><p><strong><code>示例</code></strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string">&quot;nodejs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> work_manager <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;work-manager&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token string">&quot;/path/to/script.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">await</span> work_manager<span class="token punctuation">.</span><span class="token function">addWeeklyTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> file<span class="token punctuation">,</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">1624252440000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">daysOfWeek</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;Sunday&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tasks <span class="token operator">=</span> <span class="token keyword">await</span> work_manager<span class="token punctuation">.</span><span class="token function">queryTimedTasks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> file
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;delete:&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> work_manager<span class="token punctuation">.</span><span class="token function">removeTimedTask</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="参数-9" tabindex="-1"><a class="header-anchor" href="#参数-9" aria-hidden="true">#</a> 参数</h4>`,9),rn=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"名称"),n("th",{style:{"text-align":"left"}},"类型"),n("th",{style:{"text-align":"left"}},"描述")])],-1),un=n("td",{style:{"text-align":"left"}},[n("code",null,"query?")],-1),kn={style:{"text-align":"left"}},hn=n("code",null,"TimedTaskQuery",-1),gn=n("td",{style:{"text-align":"left"}},"定时任务查询条件，为空则查询所有任务",-1),mn=o('<h4 id="返回值-9" tabindex="-1"><a class="header-anchor" href="#返回值-9" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>Task</code>[]&gt;</p><hr><h3 id="removeintenttask" tabindex="-1"><a class="header-anchor" href="#removeintenttask" aria-hidden="true">#</a> removeIntentTask</h3><p>▸ <strong>removeIntentTask</strong>(<code>id</code>): <code>Promise</code>&lt;<code>boolean</code>&gt;</p><p>通过任务id删除一个意图任务。</p><p><strong><code>参见</code></strong></p><p>Task.id</p><h4 id="参数-10" tabindex="-1"><a class="header-anchor" href="#参数-10" aria-hidden="true">#</a> 参数</h4><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code></td><td style="text-align:left;"><code>number</code></td><td style="text-align:left;">任务id</td></tr></tbody></table><h4 id="返回值-10" tabindex="-1"><a class="header-anchor" href="#返回值-10" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>boolean</code>&gt;</p><p>Promise，表示是否删除成功，若对应的任务不存在，则resolve false，否则resolve true</p><hr><h3 id="removetimedtask" tabindex="-1"><a class="header-anchor" href="#removetimedtask" aria-hidden="true">#</a> removeTimedTask</h3><p>▸ <strong>removeTimedTask</strong>(<code>id</code>): <code>Promise</code>&lt;<code>boolean</code>&gt;</p><p>通过任务id删除一个定时任务。</p><p><strong><code>参见</code></strong></p><p>Task.id</p><h4 id="参数-11" tabindex="-1"><a class="header-anchor" href="#参数-11" aria-hidden="true">#</a> 参数</h4><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code></td><td style="text-align:left;"><code>number</code></td><td style="text-align:left;">任务id</td></tr></tbody></table><h4 id="返回值-11" tabindex="-1"><a class="header-anchor" href="#返回值-11" aria-hidden="true">#</a> 返回值</h4><p><code>Promise</code>&lt;<code>boolean</code>&gt;</p><p>Promise，表示是否删除成功，若对应的任务不存在，则resolve false，否则resolve true</p>',24);function vn(fn,yn){const t=l("RouterLink"),p=l("ExternalLinkIcon");return i(),d("div",null,[u,n("ul",null,[n("li",null,[s(t,{to:"/v9/generated/interfaces/work_manager.IntentTaskConfig.html"},{default:e(()=>[a("IntentTaskConfig")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/interfaces/work_manager.IntentTaskQuery.html"},{default:e(()=>[a("IntentTaskQuery")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/interfaces/work_manager.TaskConfig.html"},{default:e(()=>[a("TaskConfig")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/interfaces/work_manager.TimedTaskConfig.html"},{default:e(()=>[a("TimedTaskConfig")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/interfaces/work_manager.TimedTaskQuery.html"},{default:e(()=>[a("TimedTaskQuery")]),_:1})])]),k,n("ul",null,[n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#datetime"},{default:e(()=>[a("DateTime")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#daysofweek"},{default:e(()=>[a("DaysOfWeek")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#tasktype"},{default:e(()=>[a("TaskType")]),_:1})])]),h,n("ul",null,[n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#addactivityintenttask"},{default:e(()=>[a("addActivityIntentTask")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#addbroadcastintenttask"},{default:e(()=>[a("addBroadcastIntentTask")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#adddailytask"},{default:e(()=>[a("addDailyTask")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#addintenttask"},{default:e(()=>[a("addIntentTask")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#addonetimetask"},{default:e(()=>[a("addOneTimeTask")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#addweeklytask"},{default:e(()=>[a("addWeeklyTask")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#getintenttask"},{default:e(()=>[a("getIntentTask")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#gettimedtask"},{default:e(()=>[a("getTimedTask")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#queryintenttasks"},{default:e(()=>[a("queryIntentTasks")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#querytimedtasks"},{default:e(()=>[a("queryTimedTasks")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#removeintenttask"},{default:e(()=>[a("removeIntentTask")]),_:1})]),n("li",null,[s(t,{to:"/v9/generated/modules/work_manager.html#removetimedtask"},{default:e(()=>[a("removeTimedTask")]),_:1})])]),g,n("ul",null,[m,v,n("li",null,[a("更多Action参见"),n("a",f,[a("Intent: Action"),s(p)])])]),y,n("table",null,[_,n("tbody",null,[n("tr",null,[b,n("td",T,[s(t,{to:"/v9/generated/interfaces/work_manager.IntentTaskConfig.html"},{default:e(()=>[x]),_:1})]),q])])]),I,n("p",null,[a("可以在Android文档"),n("a",w,[a("Intent: Action"),s(p)]),a("中找到大多数Android系统自带的Intent Action；一些系统组件也会自定义自己的Action，比如网络连接变化时触发的Action是"),A,a("（使用时需要导入ConnectivityManager)。")]),C,n("table",null,[j,n("tbody",null,[n("tr",null,[E,n("td",P,[s(t,{to:"/v9/generated/interfaces/work_manager.IntentTaskConfig.html"},{default:e(()=>[O]),_:1})]),N])])]),D,n("table",null,[B,n("tbody",null,[n("tr",null,[W,n("td",R,[s(t,{to:"/v9/generated/interfaces/work_manager.TimedTaskConfig.html"},{default:e(()=>[M]),_:1})]),S])])]),G,n("p",null,[a("推荐使用"),n("a",V,[a("addBroadcastIntentTask"),s(p)]),a("和"),n("a",L,[a("addActivityIntentTask"),s(p)]),a("，而非直接使用本函数添加任务。")]),Q,n("table",null,[F,n("tbody",null,[n("tr",null,[U,n("td",H,[s(t,{to:"/v9/generated/interfaces/work_manager.IntentTaskConfig.html"},{default:e(()=>[Y]),_:1})])])])]),K,n("table",null,[z,n("tbody",null,[n("tr",null,[$,n("td",J,[s(t,{to:"/v9/generated/interfaces/work_manager.TimedTaskConfig.html"},{default:e(()=>[X]),_:1})])])])]),Z,n("p",null,[n("a",nn,[a("Task.id"),s(p)])]),an,n("p",null,[n("a",sn,[a("Task.id"),s(p)])]),tn,n("table",null,[en,n("tbody",null,[n("tr",null,[on,n("td",pn,[s(t,{to:"/v9/generated/interfaces/work_manager.IntentTaskQuery.html"},{default:e(()=>[ln]),_:1})]),cn])])]),dn,n("table",null,[rn,n("tbody",null,[n("tr",null,[un,n("td",kn,[s(t,{to:"/v9/generated/interfaces/work_manager.TimedTaskQuery.html"},{default:e(()=>[hn]),_:1})]),gn])])]),mn])}const Tn=c(r,[["render",vn],["__file","work_manager.html.vue"]]);export{Tn as default};
