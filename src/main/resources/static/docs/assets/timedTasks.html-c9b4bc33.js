import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as l,c,d as a,e as n,b as s,w as r,f as t}from"./app-ff93bfbc.js";const u={},d=a("p",null,"该模块用于管理定时任务，用于在某些时间或某些事件触发时自动运行脚本。正如Auto.js Pro内置的定时任务功能一样，打包的脚本也可以使用这些函数来创建定时任务。",-1),k=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>$power_manager<span class="token punctuation">.</span><span class="token function">isIgnoringBatteryOptimizations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;未开启忽略电池优化&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $power_manager<span class="token punctuation">.</span><span class="token function">requestIgnoreBatteryOptimizations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),m={class:"hint-container warning"},v=a("p",{class:"hint-container-title"},"注意",-1),b={href:"https://dontkillmyapp.com/",target:"_blank",rel:"noopener noreferrer"},g=t(`<h2 id="work-manager-adddailytask-task" tabindex="-1"><a class="header-anchor" href="#work-manager-adddailytask-task" aria-hidden="true">#</a> $work_manager.addDailyTask(task)</h2><ul><li><p><code>task</code> {Object} 用于描述此定时任务的配置，包括：</p><ul><li><code>path</code> {string} 需要运行的脚本的绝对路径</li><li><code>time</code> {number} | {string} | {Date} 此定时任务每天运行的时间，支持时间戳、字符串和Date对象</li><li><code>delay</code> {number} 任务开始前的延迟，单位毫秒，默认为0；如果延时较长，则此参数并不可靠，建议勿用此参数控制大于30s的延迟</li><li><code>loopTimes</code> {number} 任务循环次数，默认为1</li><li><code>interval</code> {number} 任务循环间隔，单位毫秒，默认为0；如果间隔较长，则此参数并不可靠，建议勿用此参数控制大于30s的间隔</li></ul></li><li><p>返回 {<a href="#timedtask">TimedTask</a>}</p></li></ul><p>新增一个每日运行一次的定时任务。其中时间参数会只保留每天的时间，忽略年月日。</p><p>例如创建一个每日下午1点14分运行的定时任务：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addDailyTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-addweeklytask-task" tabindex="-1"><a class="header-anchor" href="#work-manager-addweeklytask-task" aria-hidden="true">#</a> $work_manager.addWeeklyTask(task)</h2><ul><li><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>task
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>{Object}</p><ul><li><code>path</code> {string} 需要运行的脚本的绝对路径</li><li><code>time</code> {number} | {string} | {Date} 此定时任务每天运行的时间，支持时间戳、字符串和Date对象</li><li><code>daysOfWeek</code> {string[]} 每周几运行，参数包括：<code>[&#39;sunday&#39;, &#39;monday&#39;, &#39;tuesday&#39;, &#39;wednesday&#39;, &#39;thursday&#39;, &#39;friday&#39;, &#39;saturday&#39;]</code> 或 <code>[&#39;一&#39;, &#39;二&#39;, &#39;三&#39;, &#39;四&#39;, &#39;五&#39;, &#39;六&#39;, &#39;日&#39;]</code></li><li><code>delay</code> {number} 任务开始前的延迟，单位毫秒，默认为0；如果延时较长，则此参数并不可靠，建议勿用此参数控制大于30s的延迟</li><li><code>loopTimes</code> {number} 任务循环次数，默认为1</li><li><code>interval</code> {number} 任务循环间隔，单位毫秒，默认为0；如果间隔较长，则此参数并不可靠，建议勿用此参数控制大于30s的间隔</li></ul></li><li><p>返回 {<a href="#timedtask">TimedTask</a>}</p></li></ul><p>新增一个按星期运行的定时任务。</p><p>例如创建一个每周一周二下午1点14分运行5次的定时任务</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addWeeklyTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 时间戳为Mon Jun 21 2021 13:14:00 GMT+0800 (中国标准时间)，事实上只有13:14:00的参数起作用</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">1624252440000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">daysOfWeek</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;一&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;二&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-adddisposabletask-task" tabindex="-1"><a class="header-anchor" href="#work-manager-adddisposabletask-task" aria-hidden="true">#</a> $work_manager.addDisposableTask(task)</h2><ul><li><p><code>task</code> {Object}</p><ul><li><code>path</code> {string} 需要运行的脚本的绝对路径</li><li><code>time</code> {number} | {string} | {Date} 此定时任务开始运行的时间，支持时间戳、字符串和Date对象（9.3以上版本可以用这个字段代替<code>date</code>）</li><li><code>date</code> {number} | {string} | {Date} 同<code>time</code>，由于一个失误，原本这个字段应该是<code>time</code>（9.2以之前版本需要用这个字段指定时间）</li><li><code>delay</code> {number} 任务开始前的延迟，单位毫秒，默认为0；如果延时较长，则此参数并不可靠，建议勿用此参数控制大于30s的延迟</li><li><code>loopTimes</code> {number} 任务循环次数，默认为1</li><li><code>interval</code> {number} 任务循环间隔，单位毫秒，默认为0；如果间隔较长，则此参数并不可靠，建议勿用此参数控制大于30s的间隔</li></ul></li><li><p>返回 {<a href="#timedtask">TimedTask</a>}</p></li></ul><p>此函数会新增一个一次性的定时任务，任务在执行一次后将在定时任务中自动删除。</p><p>例如创建一个2021年5月21日13点14分运行的定时任务。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addDisposableTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-addintenttask-task" tabindex="-1"><a class="header-anchor" href="#work-manager-addintenttask-task" aria-hidden="true">#</a> $work_manager.addIntentTask(task)</h2><ul><li><p><code>task</code> {Object}</p><ul><li><code>path</code> {string} 需要运行的脚本的绝对路径</li><li><code>action</code> {string} 需要监听的事件的广播的Action名称</li><li><code>delay</code> {number} 任务开始前的延迟，单位毫秒，默认为0；如果延时较长，则此参数并不可靠，建议勿用此参数控制大于30s的延迟</li><li><code>loopTimes</code> {number} 任务循环次数，默认为1</li><li><code>interval</code> {number} 任务循环间隔，单位毫秒，默认为0；如果间隔较长，则此参数并不可靠，建议勿用此参数控制大于30s的间隔</li></ul></li><li><p>返回 {<a href="#timedtask">TimedTask</a>}</p></li></ul><p>新增一个广播定时任务，会在特定事件(广播)发生时运行。</p><p>其中最关键的参数是广播事件的Action。系统在发生特定事件（比如电量变化）时会发出特定Action的广播，参见<a href="#%E5%B9%BF%E6%92%ADAction">广播Action</a>。</p><p>例如创建一个在电量发生变化时运行脚本的定时任务：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> Intent<span class="token punctuation">.</span><span class="token constant">ACTION_BATTERY_CHANGED</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-removetimedtask-id" tabindex="-1"><a class="header-anchor" href="#work-manager-removetimedtask-id" aria-hidden="true">#</a> $work_manager.removeTimedTask(id)</h2><ul><li><code>id</code> {number} 定时任务的id</li><li>返回 {boolean} 是否删除成功</li></ul><p>通过id删除按时间运行的定时任务。</p><h2 id="work-manager-removeintenttask-id" tabindex="-1"><a class="header-anchor" href="#work-manager-removeintenttask-id" aria-hidden="true">#</a> $work_manager.removeIntentTask(id)</h2><ul><li><code>id</code> {number} 定时任务的id</li><li>返回 {boolean} 是否删除成功</li></ul><p>通过id删除按事件运行的定时任务。</p><h2 id="work-manager-gettimedtask-id" tabindex="-1"><a class="header-anchor" href="#work-manager-gettimedtask-id" aria-hidden="true">#</a> $work_manager.getTimedTask(id)</h2><ul><li><code>id</code> {number} 定时任务的id</li><li>返回 {<a href="#timedtask">TimedTask</a>}</li></ul><p>通过id获取按时间运行的定时任务。</p><h2 id="work-manager-getintenttask-id" tabindex="-1"><a class="header-anchor" href="#work-manager-getintenttask-id" aria-hidden="true">#</a> $work_manager.getIntentTask(id)</h2><ul><li><code>id</code> {number}定时任务的id</li><li>返回 {<a href="#timedtask">TimedTask</a>}</li></ul><p>通过id获取按事件运行的定时任务。</p><p>例如：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 添加一个手机电量变化就触发的定时任务</span>
<span class="token keyword">let</span> id <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> Intent<span class="token punctuation">.</span><span class="token constant">ACTION_BATTERY_CHANGED</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过id找到该定时任务</span>
<span class="token keyword">let</span> task <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">getIntentTask</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印该定时任务所运行脚本的路径</span>
<span class="token function">log</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>scriptPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-querytimedtasks-options" tabindex="-1"><a class="header-anchor" href="#work-manager-querytimedtasks-options" aria-hidden="true">#</a> $work_manager.queryTimedTasks([options])</h2><ul><li><p><code>options</code> {Object} 查询参数，可选。不填时，查询到所有按时间运行的定时任务</p><ul><li><code>path</code> {string} 定时任务脚本的路径</li></ul></li><li><p>返回 {<a href="#timedtask">TimedTask</a>[]} 查找到的定时任务数组</p></li></ul><p>通过脚本路径查找按时间运行的定时任务，或者查询所有按时间运行的定时任务。</p><p>例如：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> jsPath <span class="token operator">=</span> <span class="token string">&quot;/sdcard/脚本/test.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 添加一个每周日下午1点13分运行的定时任务，循环运行5次脚本，间隔5000毫秒</span>
<span class="token keyword">let</span> task <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">addWeeklyTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> jsPath<span class="token punctuation">,</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">1624252440000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">daysOfWeek</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;sunday&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">5000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 按脚本路径查找定时任务</span>
<span class="token keyword">let</span> tasks <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">queryTimedTasks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> jsPath
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 删除查找到的所有定时任务</span>
tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;删除: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">removeTimedTask</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-queryintenttasks-options" tabindex="-1"><a class="header-anchor" href="#work-manager-queryintenttasks-options" aria-hidden="true">#</a> $work_manager.queryIntentTasks([options])</h2><ul><li><code>options</code> {Object} 查询参数，可选；不填时，查询到所有按事件运行的定时任务 <ul><li><code>path</code> {string} 定时任务脚本的路径</li><li><code>action</code> {string} 广播名称</li></ul></li><li>返回 {<a href="#timedtask">TimedTask</a>[]} 查找到的定时任务数组</li></ul><p>通过脚本路径或监听广播查找按广播运行的定时任务，或者查询所有按广播运行的定时任务。</p><p>例如：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//添加一个手机电量变化就触发的定时任务</span>
<span class="token keyword">let</span> task <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> Intent<span class="token punctuation">.</span><span class="token constant">ACTION_BATTERY_CHANGED</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查找所有的触发事件定时任务</span>
<span class="token keyword">let</span> tasks <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">queryIntentTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印所有查找到的定时任务的触发事件</span>
tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="timedtask" tabindex="-1"><a class="header-anchor" href="#timedtask" aria-hidden="true">#</a> TimedTask</h1><p>表示一个定时任务对象，包含了此定时任务的基本信息。</p><h2 id="timedtask-id" tabindex="-1"><a class="header-anchor" href="#timedtask-id" aria-hidden="true">#</a> TimedTask.id</h2><ul><li>{number}</li></ul><p>此定时任务的唯一id，用于查找定时任务。</p><h2 id="timedtask-scriptpath" tabindex="-1"><a class="header-anchor" href="#timedtask-scriptpath" aria-hidden="true">#</a> TimedTask.scriptPath</h2><ul><li>{string}</li></ul><p>此定时任务的所执行脚本的路径。</p><h2 id="timedtask-millis" tabindex="-1"><a class="header-anchor" href="#timedtask-millis" aria-hidden="true">#</a> TimedTask.millis</h2><ul><li>{number}</li></ul><p>此定时任务的执行时间的时间戳，单位为毫秒。</p><h2 id="timedtask-delay" tabindex="-1"><a class="header-anchor" href="#timedtask-delay" aria-hidden="true">#</a> TimedTask.delay</h2><ul><li>{number}</li></ul><p>此定时任务所设置的延迟，</p><h2 id="timedtask-interval" tabindex="-1"><a class="header-anchor" href="#timedtask-interval" aria-hidden="true">#</a> TimedTask.interval</h2><ul><li>{number}</li></ul><p>此定时任务循环的间隔。</p><h2 id="timedtask-looptimes" tabindex="-1"><a class="header-anchor" href="#timedtask-looptimes" aria-hidden="true">#</a> TimedTask.loopTimes</h2><ul><li>{number}</li></ul><p>此定时任务循环的次数。</p><h2 id="timedtask-action" tabindex="-1"><a class="header-anchor" href="#timedtask-action" aria-hidden="true">#</a> TimedTask.action</h2><ul><li>{string}</li></ul><p>此定时任务的触发事件（只有广播定时任务才有该参数）。</p><h1 id="广播action" tabindex="-1"><a class="header-anchor" href="#广播action" aria-hidden="true">#</a> 广播Action</h1>`,69),h={href:"https://developer.android.google.cn/reference/android/content/Intent#constants_1",target:"_blank",rel:"noopener noreferrer"},y=a("code",null,"ConnectivityManager.CONNECTIVITY_ACTION",-1),T=a("code",null,"$engines.myEngine().execArgv.intent",-1),_=a("a",{href:"#%E5%B9%BF%E6%92%AD%E5%8F%82%E6%95%B0"},"广播参数",-1),f=t(`<p>以下列出一些常见的广播Action：</p><table><thead><tr><th style="text-align:center;">广播名</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">org.autojs.autojs.action.startup</td><td style="text-align:center;">Auto.js 启动时</td></tr><tr><td style="text-align:center;">Intent.ACTION_BOOT_COMPLETED</td><td style="text-align:center;">开机时</td></tr><tr><td style="text-align:center;">Intent.ACTION_SCREEN_OFF</td><td style="text-align:center;">熄屏时</td></tr><tr><td style="text-align:center;">Intent.ACTION_SCREEN_ON</td><td style="text-align:center;">亮屏时</td></tr><tr><td style="text-align:center;">Intent.ACTION_USER_PRESENT</td><td style="text-align:center;">屏幕解锁时</td></tr><tr><td style="text-align:center;">Intent.ACTION_BATTERY_CHANGED</td><td style="text-align:center;">电量变化时</td></tr><tr><td style="text-align:center;">Intent.ACTION_POWER_CONNECTED</td><td style="text-align:center;">电源连接时</td></tr><tr><td style="text-align:center;">Intent.ACTION_POWER_DISCONNECTED</td><td style="text-align:center;">电源断开时</td></tr><tr><td style="text-align:center;">ConnectivityManager.CONNECTIVITY_ACTION</td><td style="text-align:center;">网络连接变化时</td></tr><tr><td style="text-align:center;">Intent.ACTION_PACKAGE_ADDED</td><td style="text-align:center;">新应用安装时</td></tr><tr><td style="text-align:center;">Intent.ACTION_PACKAGE_REMOVED</td><td style="text-align:center;">应用卸载时</td></tr><tr><td style="text-align:center;">Intent.ACTION_PACKAGE_REPLACED</td><td style="text-align:center;">应用更新时</td></tr><tr><td style="text-align:center;">Intent.ACTION_HEADSET_PLUG</td><td style="text-align:center;">耳机拔插时</td></tr><tr><td style="text-align:center;">Intent.ACTION_CONFIGURATION_CHANGED</td><td style="text-align:center;">某些设置（屏幕方向、地区等）更改时</td></tr><tr><td style="text-align:center;">Intent.ACTION_TIME_TICK</td><td style="text-align:center;">每分钟一次</td></tr></tbody></table><p>示例：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 添加一个Auto.js启动时触发的定时任务（在打包中软件也可以使用）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&quot;org.autojs.autojs.action.startup&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加一个网络状态变化时触发的定时任务</span>
<span class="token keyword">let</span> ConnectivityManager <span class="token operator">=</span> android<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ConnectivityManager<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/脚本/conn_test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> ConnectivityManager<span class="token punctuation">.</span><span class="token constant">CONNECTIVITY_ACTION</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="广播参数" tabindex="-1"><a class="header-anchor" href="#广播参数" aria-hidden="true">#</a> 广播参数</h1><p>按广播执行的定时任务被执行时，我们可以通过<code>$engines.myEngine().execArgv.intent</code>获取到intent对象，再通过Android文档查阅intent对象的参数，从而获取这些参数。</p>`,6),x={href:"https://developer.android.google.cn/reference/android/os/BatteryManager#EXTRA_LEVEL",target:"_blank",rel:"noopener noreferrer"},w=a("code",null,"EXTRA_LEVEL",-1),A=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 因电量变化而执行的定时任务脚本</span>
<span class="token keyword">let</span> intent <span class="token operator">=</span> $engines<span class="token punctuation">.</span><span class="token function">myEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execArgv<span class="token punctuation">.</span>intent<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请设置定时任务 - 电量变化时来运行此脚本&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> BatteryManager <span class="token operator">=</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>BatteryManager<span class="token punctuation">;</span>
<span class="token keyword">let</span> level <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getIntExtra</span><span class="token punctuation">(</span>BatteryManager<span class="token punctuation">.</span><span class="token constant">EXTRA_LEVEL</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;电量为&quot;</span><span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="bug" tabindex="-1"><a class="header-anchor" href="#bug" aria-hidden="true">#</a> Bug</h1><p>截止8.7.1版本，Auto.js Pro可能在触发定时任务时执行两次，将在8.7的后续版本中修复。</p>`,3);function I(E,j){const o=p("RouterLink"),e=p("ExternalLinkIcon");return l(),c("div",null,[d,a("p",null,[n("添加定时任务时建议加上申请忽略电池优化的代码，防止被Android限制在后台运行。参见"),s(o,{to:"/v8/powerManager.html"},{default:r(()=>[n("电池管理 - PowerManager")]),_:1}),n("。")]),k,a("div",m,[v,a("p",null,[n("由于各系统的限制，定时任务不能一定保证准时运行，请尽量将Auto.js Pro加入各种白名单和允许自启动权限。参见"),a("a",b,[n("Don't kill my app"),s(e)]),n("。")])]),g,a("p",null,[n("可以在Android文档"),a("a",h,[n("Intent: Action"),s(e)]),n("中找到大多数Android系统自带的Intent Action；一些系统组件也会自定义自己的Action，比如网络连接变化时触发的Action是"),y,n("（使用时需要导入ConnectivityManager)。这些Action通常附带一些额外参数，可以通过"),T,n("获取广播的参数，参见"),_,n("。")]),f,a("p",null,[n("例如电量变化的广播中，查询文档"),a("a",x,[n("BatteryManager"),s(e)]),n("可以知道通过"),w,n("参数获取具体电量。")]),A])}const N=i(u,[["render",I],["__file","timedTasks.html.vue"]]);export{N as default};
